<UserControl x:Class="GameClient.Wpf.GameClients.AnagramGameClient"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:local="clr-namespace:GameClient.Wpf.Converters">
	<UserControl.Resources>


		<ResourceDictionary>
			<local:BoolToOpacityConverter x:Key="BoolToOpacityConverter"/>
			<local:InverseBoolToOpacityConverter x:Key="InverseBoolToOpacityConverter"/>


			<ResourceDictionary.MergedDictionaries>
				<!-- Adjust the Source path if your styles folder is different -->
				<ResourceDictionary Source="AnagramGameStyles.xaml"/>
			</ResourceDictionary.MergedDictionaries>
		</ResourceDictionary>
	</UserControl.Resources>

	<Grid Margin="16">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<!-- Options -->
			<RowDefinition Height="Auto"/>
			<!-- Letters + timer -->
			<RowDefinition Height="Auto"/>
			<!-- Divider -->
			<RowDefinition Height="*"/>
			<!-- Player panels -->
			<RowDefinition Height="Auto"/>
			<!-- Round summary / status -->
		</Grid.RowDefinitions>

		<!-- ── Config panel (P1 only, hidden after round starts) ─────────── -->
		<Border x:Name="OptionsPanel"
				Grid.Row="0"
				Padding="12"
				Margin="0,0,0,8"
				Style="{StaticResource AnagramOptionsBorder}">
			<StackPanel Orientation="Horizontal"
						VerticalAlignment="Center">
				<TextBlock Text="Anagram Settings"
						   Style="{StaticResource AnagramOptionsHeader}"/>

				<!-- Letter count -->
				<StackPanel Orientation="Horizontal"
							VerticalAlignment="Center"
							Margin="16,0,0,0">
					<TextBlock Text="Letters:"
							   VerticalAlignment="Center"
							   Style="{StaticResource AnagramOptionsLabel}"/>
					<ComboBox x:Name="LetterCountCombo"
							  Width="60"
							  SelectedIndex="0">
						<ComboBoxItem Content="5"/>
						<ComboBoxItem Content="8"/>
						<ComboBoxItem Content="10"/>
					</ComboBox>
				</StackPanel>

				<!-- Time control -->
				<StackPanel Orientation="Horizontal"
							VerticalAlignment="Center"
							Margin="16,0,0,0">
					<TextBlock Text="Time:"
							   VerticalAlignment="Center"
							   Style="{StaticResource AnagramOptionsLabel}"/>
					<ComboBox x:Name="TimeControlCombo"
							  Width="80"
							  SelectedIndex="0">
						<ComboBoxItem Content="1:00"
									  Tag="60"/>
						<ComboBoxItem Content="2:00"
									  Tag="120"/>
						<ComboBoxItem Content="3:00"
									  Tag="180"/>
					</ComboBox>
				</StackPanel>

				<!-- Start button -->
				<Button x:Name="StartRoundButton"
						Content="Start Round"
						Margin="24,0,0,0"
						Padding="12,4"
						Click="StartRoundButton_Click"
						Style="{StaticResource AnagramPrimaryButton}"/>
			</StackPanel>
		</Border>

		<!-- ── Letters + Timer ───────────────────────────────────────────── -->
		<StackPanel Grid.Row="1"
					x:Name="RoundInfoPanel"
					Visibility="Collapsed"
					HorizontalAlignment="Center"
					Margin="0,0,0,8">
			<ItemsControl x:Name="LetterCards"
						  Margin="0,6,0,10"
						  HorizontalAlignment="Center">
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<StackPanel Orientation="Horizontal"/>
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>

				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<Border Width="56"
								Height="72"
								Margin="6,0"
								CornerRadius="10"
								Background="#1E1E24"
								BorderBrush="#3A3A46"
								BorderThickness="1"
								SnapsToDevicePixels="True">
							<Border.RenderTransform>
								<!-- We animate ScaleX to simulate a flip -->
								<ScaleTransform x:Name="CardFlipScale"
												ScaleX="1"
												ScaleY="1"/>
							</Border.RenderTransform>
							<Border.RenderTransformOrigin>0.5,0.5</Border.RenderTransformOrigin>

							<Grid>
								<!-- Scrabble value in corner -->
								<TextBlock Text="{Binding Value}"
										   Margin="6,4,0,0"
										   HorizontalAlignment="Left"
										   VerticalAlignment="Top"
										   Foreground="#B8B8C6"
										   FontSize="12"
										   FontWeight="SemiBold"
										   Opacity="{Binding IsRevealed, Converter={StaticResource BoolToOpacityConverter}}"/>

								<!-- Letter big in center -->
								<TextBlock Text="{Binding Letter}"
										   HorizontalAlignment="Center"
										   VerticalAlignment="Center"
										   Foreground="White"
										   FontSize="30"
										   FontWeight="Bold"
										   Opacity="{Binding IsRevealed, Converter={StaticResource BoolToOpacityConverter}}"/>

								<!-- Back of card (when hidden) -->
								<TextBlock Text="?"
										   HorizontalAlignment="Center"
										   VerticalAlignment="Center"
										   Foreground="#7C7C8A"
										   FontSize="28"
										   FontWeight="Bold"
										   Opacity="{Binding IsRevealed, Converter={StaticResource InverseBoolToOpacityConverter}}"/>
							</Grid>
						</Border>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>

			<TextBlock x:Name="TimerText"
					   Text="00:00"
					   Style="{StaticResource AnagramTimerText}"/>
		</StackPanel>

		<!-- Divider -->
		<Separator Grid.Row="2"
				   Margin="0,0,0,8"
				   Style="{StaticResource AnagramDivider}"/>

		<!-- ── Player panels ─────────────────────────────────────────────── -->
		<Grid Grid.Row="3" x:Name="PlayersGrid">
			<Grid.ColumnDefinitions>
				<ColumnDefinition x:Name="ColP1"
						Width="*"/>
				<ColumnDefinition x:Name="ColP2"
						Width="*"/>
				<ColumnDefinition x:Name="ColPossible"
						Width="0"/>
			</Grid.ColumnDefinitions>

			<!-- P1 panel -->
			<Border Grid.Column="0"
					Margin="0,0,8,0"
					Style="{StaticResource AnagramPlayerPanel}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<!-- header -->
						<RowDefinition Height="*"/>
						<!-- words list -->
						<RowDefinition Height="Auto"/>
						<!-- input (if local player) -->
					</Grid.RowDefinitions>

					<!-- Header -->
					<DockPanel Grid.Row="0"
							   Margin="0,0,0,4">
						<TextBlock Text="Host (P1)"
								   Style="{StaticResource AnagramPlayerHeader}"/>
						<TextBlock Text="Score:"
								   Margin="12,0,0,0"
								   VerticalAlignment="Center"
								   Style="{StaticResource AnagramScoreLabel}"/>
						<TextBlock x:Name="P1ScoreText"
								   Text="0"
								   Margin="4,0,0,0"
								   VerticalAlignment="Center"
								   Style="{StaticResource AnagramScoreValue}"/>
					</DockPanel>

					<!-- Words list -->
					<ScrollViewer Grid.Row="1">
						<ItemsControl x:Name="P1WordsList"
									  Style="{StaticResource AnagramWordsListStyle}"/>
					</ScrollViewer>

					<!-- Input (only shown when this client is P1) -->
					<StackPanel x:Name="P1InputPanel"
								Grid.Row="2"
								Orientation="Horizontal"
								Margin="0,8,0,0"
								Visibility="Collapsed">
						<TextBox x:Name="P1WordInput"
								 Width="160"
								 Margin="0,0,8,0"
								 Style="{StaticResource AnagramWordInputBox}"
								 PreviewKeyDown="WordInput_PreviewKeyDown"
								 KeyDown="WordInput_KeyDown">
							<TextBox.RenderTransform>
								<TranslateTransform/>
							</TextBox.RenderTransform>
						</TextBox>
						<Button Content="Submit"
								Padding="8,2"
								Click="P1SubmitButton_Click"
								Style="{StaticResource AnagramSecondaryButton}"/>
					</StackPanel>
				</Grid>
			</Border>

			<!-- P2 panel -->
			<Border Grid.Column="1"
					Margin="8,0,0,0"
					Style="{StaticResource AnagramPlayerPanel}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>

					<!-- Header -->
					<DockPanel Grid.Row="0"
							   Margin="0,0,0,4">
						<TextBlock Text="Guest (P2)"
								   Style="{StaticResource AnagramPlayerHeader}"/>
						<TextBlock Text="Score:"
								   Margin="12,0,0,0"
								   VerticalAlignment="Center"
								   Style="{StaticResource AnagramScoreLabel}"/>
						<TextBlock x:Name="P2ScoreText"
								   Text="0"
								   Margin="4,0,0,0"
								   VerticalAlignment="Center"
								   Style="{StaticResource AnagramScoreValue}"/>
					</DockPanel>

					<!-- Words list -->
					<ScrollViewer Grid.Row="1">
						<ItemsControl x:Name="P2WordsList"
									  Style="{StaticResource AnagramWordsListStyle}"/>
					</ScrollViewer>

					<!-- Input (only shown when this client is P2) -->
					<StackPanel x:Name="P2InputPanel"
								Grid.Row="2"
								Orientation="Horizontal"
								Margin="0,8,0,0"
								Visibility="Collapsed">
						<TextBox x:Name="P2WordInput"
								 Width="160"
								 Margin="0,0,8,0"
								 Style="{StaticResource AnagramWordInputBox}"
								 PreviewKeyDown="WordInput_PreviewKeyDown"
								 KeyDown="WordInput_KeyDown">
							<TextBox.RenderTransform>
								<TranslateTransform/>
							</TextBox.RenderTransform>
						</TextBox>
						<Button Content="Submit"
								Padding="8,2"
								Click="P2SubmitButton_Click"
								Style="{StaticResource AnagramSecondaryButton}"/>
					</StackPanel>
				</Grid>
			</Border>
			<Border
				x:Name="PossibleWordsPanel"
				Grid.Column="2"
				Margin="8,0,0,0"
				Style="{StaticResource AnagramPlayerPanel}"
				Visibility="Collapsed">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<TextBlock Text="Possible Words"
							   Style="{StaticResource AnagramPlayerHeader}"
							   Margin="0,0,0,4"/>

					<ScrollViewer Grid.Row="1">
						<ItemsControl x:Name="PossibleWordsList"
									  Style="{StaticResource AnagramWordsListStyle}"/>
					</ScrollViewer>
				</Grid>
			</Border>

	</Grid>

	<!-- ── Status / Round summary text ───────────────────────────────── -->
	<TextBlock x:Name="StatusText"
			   Grid.Row="4"
			   Margin="0,8,0,0"
			   Text=""
			   HorizontalAlignment="Center"
			   Style="{StaticResource AnagramStatusText}"/>
	</Grid>
</UserControl>
